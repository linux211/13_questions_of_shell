
Logo å†™æ–‡ç«  æ³¨å†Œ ç™»å½•

    é¦–é¡µ
    ä¸‹è½½App

æ ‘è“æ´¾Pi3è®¾ç½®wifiçƒ­ç‚¹
96
ä½œè€… xaiolos
2017.02.12 10:27* å­—æ•° 1401

        å¹´å‰æ¢äº†éƒ¨æ‰‹æœºè¿˜æ˜¯iphoneçš„ï¼Œä½†æ˜¯å‡ å¹´è¿‡å»äº†ï¼Œgoogleé‚®ç®±ï¼Œdigg readerçš„googleè´¦å·æ²¡æ³•ç›´æ¥ç™»é™†å•¦ï¼Œæ‚è„¸ã€‚ç¿»å¢™è¦è¶Šç‹±ï¼Œæƒ³ç®€å•ç‚¹æ‹¿å°ç¬”è®°æœ¬ä¿®æ”¹ä¸ªhostså†å¼€ä¸ªçƒ­ç‚¹å°±å¯ä»¥å•¦ï¼Œéƒé—·çš„æ˜¯ç”¨çš„macbook airæ²¡æœ‰æœ‰çº¿æ’å£å¼€ä¸äº†wifiçƒ­ç‚¹ï¼Œå†æ‚è„¸ã€‚åªèƒ½æ‰“èµ·æ ‘è“æ´¾çš„æ³¨æ„ã€‚ç³»ç»Ÿå•¥çš„å°±ä¸è¯´äº†ï¼Œç›´æ¥æ­£é¢˜ï¼š
ä¸€ã€å®‰è£…hostapdå’Œdnsmasqè½¯ä»¶åŒ…

å¤©å¤©å¹²ç€linuxä¸Šçš„è·¯ç”±ç³»ç»Ÿï¼Œå±…ç„¶æ²¡æ¥è§¦åˆ°è¿™ä¸¤ä¸ªè½¯ä»¶ï¼Œå¯è§æ‰“æ‚åŠŸåº•è‡³æ·±ï¼Œæœ‰ç©ºç ”ç©¶ç ”ç©¶å§ã€‚ç…§ä¾‹å…ˆè£…ç€ï¼š

    sudo apt-get install dnsmasq hostapd

hostapd æ˜¯ Host Access Point å®ˆæŠ¤è¿›ç¨‹ï¼Œæä¾›å¯¹åŸºäº Linux çš„æ— çº¿æ¥å…¥ç‚¹çš„å¼º WPA2 åŠ å¯†å’Œèº«ä»½éªŒè¯ã€‚é…ç½® hostapd éå¸¸ç®€å•ï¼Œå®ƒæ”¯æŒ WPA2-Personal å’Œ Enterpriseï¼Œæä¾›äº†å¯¹ WPA2-Personal çš„ç‹¬ç‰¹ä¿®æ”¹ï¼Œå¯è®©ç®¡ç†å®ƒå˜å¾—æ›´å¤æ‚æˆ–æ›´ç®€å•ã€‚

dnsmasqæ˜¯ä¸€ä¸ªå°å·§ä¸”æ–¹ä¾¿åœ°ç”¨äºé…ç½®DNSå’ŒDHCPçš„å·¥å…·ï¼Œé€‚ç”¨äºå°å‹ç½‘ç»œï¼Œå®ƒæä¾›äº†DNSåŠŸèƒ½å’Œå¯é€‰æ‹©çš„DHCPåŠŸèƒ½ã€‚ä¸»ç”¨é€‚ç”¨äºNATçš„å®¶åº­ç½‘ç»œï¼Œç”¨modemï¼Œcable modemï¼ŒADSLè®¾å¤‡è¿æ¥åˆ°å› ç‰¹ç½‘ã€‚
äºŒã€æ¥å£é…ç½®

å°†æ— çº¿æ¥å£wlan0çš„IPé…ç½®æˆé™æ€åœ°å€ã€‚ä»¥å¤ªç½‘æ¥å£eth0é»˜è®¤DHCPé…ç½®å¹¶æ¥å…¥å› ç‰¹ç½‘ã€‚åœ¨æ ‘è“æ´¾ç³»ç»Ÿä¸­ï¼Œé»˜è®¤æ˜¯DHCPCDé…ç½®ç½‘ç»œæ¥å£ã€‚æ‰€ä»¥è¦å‘Šè¯‰ç³»ç»Ÿæˆ‘ä»¬ç»™wlan0åˆ†é…é™æ€IPåœ°å€ï¼Œæ“ä½œæ˜¯æ‰“å¼€é…ç½®æ–‡ä»¶å¹¶å¢åŠ é…ç½®å‚æ•°æŒ‡ä»¤ã€‚

    sudo nano /etc/dhcpcd.conf

    interface wlan0

    static ip_address=192.168.0.1/24

ä¸ºäº†é˜²æ­¢wpa_supplicantè¿è¡Œå’Œå¹²æ‰°è®¾å®šwlan0ä¸ºæ¥å…¥ç‚¹æ¨¡å¼ã€‚éœ€è¦æ‰“å¼€æ¥å£é…ç½®æ–‡ä»¶ï¼Œåœ¨wlan0æ®µè½ä¸­æ³¨é‡Šæ‰wpa-confè¿™è¡Œ

    sudo nano /etc/network/interfaces

    allow-hotplug wlan0

    iface wlan0 inet manual

    #    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

æ‰§è¡Œå®Œåè¿˜è¦é‡å¯dhcpcdæœåŠ¡ï¼Œç³»ç»Ÿå°†ä¼šç»™wlan0æ¥å£åˆ†é…ä¸€ä¸ªé™æ€IPï¼Œæ ‘è“æ´¾ä¹Ÿéœ€è¦é‡å¯ï¼Œå› ä¸ºåªæœ‰é‡å¯åæ‰ç”Ÿæ•ˆã€‚

    sudo service dhcpcd restart

    sudo reboot

ä¸‰ã€ é…ç½®HOSTAPD

åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶é…ç½®HOSTAPD

    sudo nano /etc/hostapd/hostapd.conf

å†…å®¹å¦‚ä¸‹

    interface=wlan0

    driver=nl80211

    ssid=pipi

    hw_mode=g

    channel=6

    wmm_enabled=1

    macaddr_acl=0

    auth_algs=1

    ignore_broadcast_ssid=0

    wpa=2

    wpa_passphrase=12345678

    wpa_key_mgmt=WPA-PSK

    rsn_pairwise=CCMP

å…¶ä¸­

interface=wlan0ï¼ŒæŒ‡å®šç½‘å¡åç§°ä¸ºwlan0ã€‚

wpa=2ï¼Œé‡‡ç”¨WPA2åŠ å¯†æ–¹å¼ã€‚

ssid=pipiä¸ºçƒ­ç‚¹åç§°ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚

wpa_passphrase=12345678ä¸ºçƒ­ç‚¹å¯†ç ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼Œå¦‚æœé‡‡ç”¨WPA2åŠ å¯†æ–¹å¼ï¼Œå¯†ç çš„é•¿åº¦åº”è¯¥ä¸å°‘äº8ä¸ªå­—ç¬¦ã€‚

æ¥ä¸‹æ¥æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ,å¦‚æœå‡ºç°AP-ENABLEDå¹¶ä¸”å®¢æˆ·ç«¯èƒ½æœç´¢åˆ°SSIDï¼Œè¡¨ç¤ºAPæ¨¡å¼å·²å¯ç”¨æˆåŠŸã€‚å¦‚æœæœ‰æŠ¥é”™ï¼Œè¯´æ˜é©±åŠ¨å’Œhostapdé…ç½®æ²¡æœ‰æ­£ç¡®è®¾ç½®ã€‚

    sudo /usr/sbin/hostapd /etc/hostapd/hostapd.conf


ä¸ºäº†èƒ½è®©ç³»ç»Ÿæ¯æ¬¡å¯åŠ¨éƒ½è‡ªåŠ¨åŠ è½½APæ¨¡å¼ä¸‹çš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®hostapdä¸ºè‡ªå¯åŠ¨æ¨¡å¼ã€‚æ‰“å¼€é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°#DAEMON_CONF=â€â€ï¼Œå°†å‰é¢çš„#å·å»æ‰ï¼Œ

    sudo nano /etc/default/hostapd

    DAEMON_CONF="/etc/hostapd/hostapd.conf"

æ‰‹æœºæµ‹è¯•è¿æ¥apæ­£å¸¸ã€‚
å››ã€é…ç½®DNSMASQ

ä¸ºäº†å®ç°ä¸Šç½‘åŠŸèƒ½ï¼Œéœ€è¦å¯¹DNSMASQæœåŠ¡è¿›è¡Œé…ç½®ï¼Œé¦–å…ˆå¤‡ä»½ä¸€ä¸‹ç³»ç»Ÿé»˜è®¤çš„æ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ã€‚

    sudo mv /etc/dnsmasq.conf/etc/bak_dnsmasq.conf

    sudo nano /etc/dnsmasq.conf

å…·ä½“çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼šDNSè¯·æ±‚æœåŠ¡å™¨åœ°å€è¿™é‡Œè¦é…ç½®æˆæœ¬åœ°ä¸Šç½‘çš„DNSåœ°å€ï¼Œå¦åˆ™å¯èƒ½è§£æé”™è¯¯ã€‚

    interface=wlan0

    bind-interfaces

    server=218.2.2.2

    server=114.114.114.114

    server=8.8.8.8

    domain-needed

    bogus-priv

    dhcp-range=192.168.1.2,192.168.1.254,12h

äº”ã€è®¾ç½®IPV4è½¬å‘

æ‰“å¼€ç³»ç»Ÿé…ç½®æ–‡ä»¶sysctl.conf,å°†IPV4è½¬å‘é‚£ä¸€è¡Œçš„#å»æ‰

    sudo nano /etc/sysctl.conf

    # Uncomment the next two lines toenable Spoof protection (reverse-path filter)

    # Turn on Source AddressVerification in all interfaces to

    # prevent some spoofing attacks

    #net.ipv4.conf.default.rp_filter=1

    #net.ipv4.conf.all.rp_filter=1

    # Uncomment the next line toenable TCP/IP SYN cookies

    # Note: This may impact IPv6 TCPsessions too

    #net.ipv4.tcp_syncookies=1

    # Uncomment the next line toenable packet forwarding for IPv4

    net.ipv4.ip_forward=1

ä¸‹ä¸€æ¬¡é‡å¯åä¼šç”Ÿæ•ˆï¼Œå¦‚æœä¸æƒ³ç°åœ¨é‡å¯ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å¦‚ä¸‹æŒ‡ä»¤ç›´æ¥ç”Ÿæ•ˆã€‚

    sudo sh -c "echo 1 >/proc/sys/net/ipv4/ip_forward"

ä¸ºäº†å®ç°PI3ä»¥å¤ªç½‘æ¥å£å…±äº«ç»™wlan0ä¸Šç½‘ï¼Œéœ€è¦é…ç½®NATï¼Œéœ€å…ˆæ‰§è¡Œå¦‚ä¸‹é˜²ç«å¢™å‘½ä»¤

    sudo iptables -t nat -APOSTROUTING -o eth0 -j MASQUERADE

    sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT

    sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT

å½“ç„¶ï¼Œä¸ºäº†ä¸æ¯æ¬¡éƒ½æ‰‹åŠ¨é…ç½®ï¼Œéœ€è¦å°†ä»¥ä¸Šè§„åˆ™è®¾ä¸ºè‡ªå¯åŠ¨ã€‚

    sudo sh -c "iptables-save> /etc/iptables.ipv4.nat"

é€šè¿‡è·å–DHCPCDæ¥è¿è¡ŒNATéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶

    sudo nano/lib/dhcpcd/dhcpcd-hooks/70-ipv4-nat

    iptables-restore</etc/iptables.ipv4.nat

æœ€åéœ€è¦é‡å¯æœåŠ¡ï¼š

    sudo service hostapdstart

    sudo service dnsmasq start

    sudo reboot

å½“ç„¶æ ‘è“æ´¾è¿˜æ˜¯è¦æ‹¿æ¥è¿wifiä¸Šç½‘ï¼Œä¸Šè¿°iptbalesè®¾ä¸ºè‡ªå¯åŠ¨è¿˜æ²¡æœ‰å°è¯•ï¼Œåªæ˜¯å¼€æœºåä¸‹äº†ä¸‰æ¡iptableså‘½ä»¤ï¼Œæµ‹è¯•OKå•¦ã€‚ä¿®æ”¹äº†linuxä¸‹etc/hostsï¼Œæ‰‹æœºè¿ä¸Šç™»é™†gmailï¼Œgoogleè´¦å·ä¸€åˆ‡æ­£å¸¸ã€‚ğŸ˜„

å‚è€ƒï¼š

PI3ä½“éªŒä¹‹æ— çº¿ç½‘APæ¨¡å¼è®¾å®šåŠçƒ­ç‚¹åˆ†äº«

http://bbs.elecfans.com/forum.php?mod=viewthread&tid=605803&extra=page=5&mobile=2
æ ‘è“æ´¾
Â© è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰
ä¸¾æŠ¥æ–‡ç« 
96
xaiolos
æ›´å¤šåˆ†äº«
